<h2 class="pb-4">User Management</h2>
<ngb-alert *ngIf="error" type="danger" [dismissible]="false">
  <img src="/assets/svg/red-triangle.svg" alt="" width="16" height="" class="mr-2">
  <h6 class="mr-2 d-inline font-weight-bold">An error occurred:</h6>
  <p class="mb-0 pl-4">{{error}}</p>
</ngb-alert>

<table class="table table-bordered mb-5">
  <thead class="thead-light">
    <tr>
      <th scope="col">Username</th>
      <th scope="col">Email</th>
      <th scope="col">Role</th>
      <th scope="col">Action</th>
    </tr>
  </thead>
  <tbody>
  <tr *ngIf="users.length === 0">
    <td [colSpan]="4">No additional users are setup. Create a new user below.</td>
  </tr>
  <tr *ngFor="let user of users">
    <td>{{user.username}}</td>
    <td>{{user.email}}</td>
    <td>
      <span [hidden]="user.role !== adminRole">Administrator</span>
      <span [hidden]="user.role !== developerRole">Developer</span>
      <span [hidden]="user.role !== maintainerRole">Maintainer</span>
      <span [hidden]="user.role !== readonlyRole">View Only</span>
    </td>
    <td><button type="button" class="btn btn-danger btn-outline-dark" (click)="deleteUser(user.username)">Delete</button></td>
  </tr>
  </tbody>
</table>

<h5 class="pt-4">Add new user</h5>
<hr class="mb-4">

<ngb-alert *ngIf="userCreateError" type="danger" [dismissible]="false">
  <img src="/assets/svg/red-triangle.svg" alt="" width="16" height="" class="mr-2">
  <h6 class="mr-2 d-inline font-weight-bold">An error occurred:</h6>
  <p class="mb-0 pl-4">{{userCreateError}}</p>
</ngb-alert>

<div class="container mb-5">
  <form [formGroup]="createUserForm" (ngSubmit)="addUser()">
    <div class="row">
      <div class="col d-flex justify-content-between align-items-center">
        <div class="col-md-6">
          <label class="d-inline" for="email">Email</label>
        </div>
        <input type="email" id="email" class="form-control my-2" placeholder="email@example.com" required formControlName="email" [ngClass]="{'is-invalid': f.email.dirty && f.email.errors}">
        <div class="invalid-tooltip" [hidden]="f.email.disabled || f.email.valid || f.email.pristine">Email is required</div>
      </div>
    </div>

    <div class="row">
      <div class="col d-flex justify-content-between align-items-center">
        <div class="col-md-6">
          <label class="d-inline" for="username">Username</label>
        </div>
        <input type="text" id="username" class="form-control my-2" placeholder="Username" required formControlName="username" [ngClass]="{'is-invalid': f.username.dirty && f.username.errors}">
        <div class="invalid-tooltip" [hidden]="f.username.disabled || f.username.valid || f.username.pristine">Username is required</div>
      </div>
    </div>

    <div class="row">
      <div class="col d-flex justify-content-between align-items-center">
        <div class="col-md-6">
          <label class="d-inline" for="password">Password</label>
        </div>
        <input type="password" id="password" class="form-control my-2" placeholder="Password" required formControlName="password" [ngClass]="{'is-invalid': f.password.dirty && f.password.errors}">
        <div class="invalid-tooltip" [hidden]="f.password.disabled || f.password.valid || f.password.pristine">Password is required, must be 8 chars or longer and consist of at least a capital letter, a small letter and a number.</div>
      </div>
    </div>

    <div class="row">
      <div class="col d-flex justify-content-between align-items-center">
        <div class="col-md-6">
          <label class="d-inline">Role</label>
        </div>

          <div class="btn-group mr-3">
            <button disabled class="btn btn-outline-dark disabled">
              <span [hidden]="f.role.value !== +adminRole">Administrator</span>
              <span [hidden]="f.role.value !== +developerRole">Developer</span>
              <span [hidden]="f.role.value !== +maintainerRole">Maintainer</span>
              <span [hidden]="f.role.value !== +readonlyRole">View Only</span>
            </button>
            <div class="btn-group" ngbDropdown role="group">
              <button type="button" class="btn btn-primary dropdown-toggle-split" ngbDropdownToggle></button>
              <div class="dropdown-menu" ngbDropdownMenu>
                <button type="button" ngbDropdownItem (click)="f.role.setValue(+adminRole)">Administrator</button>
                <button type="button" ngbDropdownItem (click)="f.role.setValue(+developerRole)">Developer</button>
                <button type="button" ngbDropdownItem (click)="f.role.setValue(+maintainerRole)">Maintainer</button>
                <button type="button" ngbDropdownItem (click)="f.role.setValue(+readonlyRole)">View Only</button>
              </div>
            </div>
          </div>
          <div class="invalid-tooltip" [hidden]="f.role.disabled || f.role.valid || f.role.pristine">Role is required</div>
      </div>
    </div>

    <div class="row">
      <div class="col d-flex justify-content-between align-items-center">
        <button type="submit" [disabled]="createUserForm.invalid" class="btn btn-primary btn-sm">Save</button>
      </div>
    </div>
  </form>
</div>
